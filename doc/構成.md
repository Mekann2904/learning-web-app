# Web app 構成

| コンポーネント     | 役割                       | 技術                             |
| ----------- | ------------------------ | ------------------------------ |
| フロント/SSR    | 画面レンダリングと最小のページルーティング    | Astro（@astrojs/cloudflare）     |
| エッジ実行/配信    | リクエスト終端、SSR実行、静的資産配信     | Cloudflare Workers             |
| API         | 認証・権限・入力検証・DB/R2 I/O の集約 | Hono（/api/\*）                  |
| 認証          | Cookieベースのステートレスセッション管理  | Better Auth（署名付きセッション）         |
| データベース      | リレーショナルデータの永続化           | Supabase Postgres              |
| DB接続        | エッジからの接続最適化・コネクション管理     | Cloudflare Hyperdrive          |
| ORM/クエリ     | 型安全なスキーマとI/O             | Drizzle ORM + postgres.js      |
| オブジェクトストレージ | 画像・バイナリ格納（私有）            | Cloudflare R2（署名付きURLでGET/PUT） |
| レート制限       | 濫用抑止の初期ライン               | Hono middleware                |
| 可観測性        | メトリクスと構造化ログ収集            | Workers Analytics Engine       |

```
[Browser]
   │
   ▼
[Cloudflare Workers / Astro SSR] ── 静的資産
   │                         │
   │                         └─────────────► [R2] （署名付きURLで直接配信）
   │
   └──── /api/* ───────────────────────────► [Hono API]
                                             │
                               ┌─────────────┴─────────────┐
                               ▼                           ▼
                        [Hyperdrive]                 [Better Auth]
                               │                      （Cookie検証）
                               ▼
                      [Supabase Postgres]
```

